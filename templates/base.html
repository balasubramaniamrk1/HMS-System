{% load static %}
{% load auth_extras %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HMS{% endblock %} | Multi-Speciality Hospital</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v=2.4">
    {% block extra_css %}{% endblock %}
</head>

<body>

    <header>
        <div class="container">
            <nav class="navbar">
                <a href="/" class="brand"><i class="fas fa-heartbeat mr-2"></i>HealthPlus</a>
                <div class="nav-menu">
                    <a href="/" class="nav-link">Home</a>
                    <a href="{% url 'about' %}" class="nav-link">About</a>
                    <a href="{% url 'department_list' %}" class="nav-link">Center of Excellence</a>
                    <a href="{% url 'doctor_list' %}" class="nav-link">Doctors</a>
                    <a href="{% url 'package_list' %}" class="nav-link">Packages</a>

                    {% if not user.is_authenticated %}
                    <a href="{% url 'login' %}" class="nav-link">Login</a>
                    {% endif %}
                </div>
                <a href="{% url 'book_appointment' %}" class="btn btn-primary btn-sm ml-3">Book Appointment</a>
                {% if user.is_authenticated %}
                <a href="{% url 'logout' %}" class="btn btn-danger btn-sm ml-2"><i class="fas fa-power-off mr-1"></i>
                    Logout</a>
                {% endif %}
                <div class="mobile-toggle d-md-none"><i class="fas fa-bars"></i></div>
            </nav>
        </div>
    </header>

    <!-- App Container: Flex layout if authenticated, standard block if not -->
    <div class="{% if user.is_authenticated %}app-container{% endif %}">

        {% if user.is_authenticated %}
        <!-- Persistent Sidebar -->
        <aside class="app-sidebar active">
            <ul class="app-sidebar-menu">
                {% for item in sidebar_menu %}
                <li>
                    <a href="{{ item.url }}" class="{% if request.path == item.url %}active{% endif %}">
                        <i class="{{ item.icon }}"></i> {{ item.label }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </aside>
        {% endif %}

        <!-- Main Content Wrapper -->
        <main class="{% if user.is_authenticated %}app-main-content{% endif %}">
            {% block content %}{% endblock %}
        </main>

    </div>

    <!-- Global Message Modal -->
    {% if messages %}
    <div id="messageContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999; width: 350px;">
        {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show shadow-lg"
            role="alert">
            <strong>
                {% if message.tags == 'error' %}<i class="fas fa-exclamation-circle mr-2"></i>Error
                {% elif message.tags == 'success' %}<i class="fas fa-check-circle mr-2"></i>Success
                {% elif message.tags == 'warning' %}<i class="fas fa-exclamation-triangle mr-2"></i>Warning
                {% else %}Notification{% endif %}
            </strong><br>
            {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        {% endfor %}
    </div>
    <script>
        // Auto-dismiss messages after 5 seconds
        setTimeout(function () {
            $('.alert').alert('close');
        }, 5000);
    </script>
    {% endif %}

    <footer>
        <div class="container">
            <p>&copy; 2025 HealthPlus Multi-Speciality Hospital. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS and Dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    {% block extra_js %}{% endblock %}
</body>

</html>