{% extends 'base.html' %}
{% load static %}

{% block title %}Doctor Console{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Doctor Console</h1>
        <p>My Appointments & Consultations</p>
        <div class="mt-3">
            <a href="{% url 'pharmacy:stock_list' %}" class="btn btn-warning"
                style="background-color: #ffc107; color: black; padding: 10px 20px; text-decoration: none; border-radius: 5px;"
                target="_blank">
                <i class="fas fa-pills"></i> Check Medicine Availability
            </a>
        </div>
    </div>
</section>

<section class="container section-padding">
    <h2>Confirmed Appointments</h2>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="grid-2">
        {% for appt in appointments %}
        <div class="card"
            style="padding: 20px; border-left: 5px solid {% if appt.preferred_date < today %}red{% else %}var(--primary-color){% endif %}; {% if appt.preferred_date < today %}color: red;{% endif %}">
            <h3>{{ appt.name }}</h3>
            <p><strong>Time:</strong> {{ appt.preferred_date }} ({{ appt.preferred_time }})</p>
            <p><strong>Issue:</strong> {{ appt.message|default:"No details provided" }}</p>
            <div style="margin-top: 15px;">
                <a href="{% url 'consultation' appt.pk %}" class="btn-primary"
                    style="display:inline-block; width: auto; margin-right: 10px;">Start Consultation</a>

                {% if appt.preferred_date < today %} <div
                    style="margin-top: 15px; border-top: 1px solid #ccc; padding-top: 10px;">
                    <p style="font-size: 0.9rem; margin-bottom: 5px; color: #555;">Reschedule Appointment:</p>
                    <form action="{% url 'reschedule_appointment' appt.pk %}" method="post"
                        style="display: flex; gap: 10px; align-items: center;">
                        {% csrf_token %}
                        <input type="date" name="new_date" required class="form-control"
                            style="padding: 5px; width: auto;">
                        <button type="submit" class="btn-primary"
                            style="padding: 5px 10px; font-size: 0.9rem; background: #f39c12;">Move</button>
                    </form>
                    <div style="margin-top: 10px;">
                        <a href="{% url 'cancel_appointment_doctor' appt.pk %}"
                            onclick="return confirm('Are you sure you want to cancel this appointment?');"
                            style="color: #dc3545; text-decoration: underline; font-size: 0.9rem;">Cancel
                            Appointment</a>
                    </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <p>No confirmed appointments for today.</p>
    {% endfor %}
    </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        background: var(--secondary-color);
        color: white;
        padding: 30px 0;
        text-align: center;
    }

    .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 30px;
    }

    @media (max-width: 768px) {
        .grid-2 {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}